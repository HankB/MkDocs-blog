{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to MkDocs For full documentation visit mkdocs.org . Commands mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit. Project layout mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Welcome to MkDocs"},{"location":"#welcome-to-mkdocs","text":"For full documentation visit mkdocs.org .","title":"Welcome to MkDocs"},{"location":"#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit.","title":"Commands"},{"location":"#project-layout","text":"mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Project layout"},{"location":"main/","text":"Hank's Docs home page wonder what this looks like","title":"Hank's Docs home page"},{"location":"main/#hanks-docs-home-page","text":"wonder what this looks like","title":"Hank's Docs home page"},{"location":"test-debug/Pi-4B-Bookworm-WiFi/","text":"Testing networking (WiFi, ETH) Pi 4B Testing the network interfaces on a Pi 4B running Debian Bookworm with available kernel packages. Following installation the `raspi-firmware1 package was held due to performance probnlems with the upgrade. All testing was performed with the firmware that came with the install media. Initial tests were hampered by two issues. I had mistyped the WiFi password causing connection attempts to fail. Ethernet was unmanaged and remained configured even when physically disconnected. This masked WiFi even though WiFi appeared to be associated (wlan0 had an IP address handed out by the local DHCP server.) I got the Ethernet under NetworkManager control and retyped the password and achieved some success with WiFi. Ethernet seemed to work without difficulty with all kernels. Status I'm not happy with results, will retest when I have a chance (not till the weekend.) 5.15.0-2-arm64 This is the kernel that comes with the install media ( 20220121_raspi_4_bookworm.img.xz ). Linux up 5.15.0-2-arm64 #1 SMP Debian 5.15.5-2 (2021-12-18) aarch64 GNU/Linux No WiFi. dmesg capture at https://paste.debian.net/1236231/ No wlan0 in ip addr output. Ethernet seems to work OK. 5.16.0-5-arm64 This is the kernel available in the repo to upgrade following installation. Linux up 5.16.0-5-arm64 #1 SMP Debian 5.16.14-1 (2022-03-15) aarch64 GNU/Linux WiFi works w/out difficulty on both 5G and 2.4G APs. Switching repeatedly between the two SSIDs takes less than ten seconds. 5.17.0-rc8-arm64 Available from experimental Linux up 5.17.0-rc8-arm64 #1 SMP Debian 5.17~rc8-1~exp1 (2022-03-14) aarch64 GNU/Linux WiFi works on 5G, does not associate on 2.4G. Captured output to daemon.log when trying to switch from an associated 5G AP to a 2.4G AP up until NM re-requested the WiFi password. https://paste.debian.net/1236229/ Connect times to the 5G AP was quick at times and not quick other times. At one point it was necessary to turn WiFi off and on again to get it to associate. (Both 5G and 2.4G radios are on the same WiFi AP.) Did not shutdown cleanly. Had to pull power. 5.17.0-trunk-arm64 From experimental Linux up 5.17.0-trunk-arm64 #1 SMP Debian 5.17.1-1~exp1 (2022-03-29) aarch64 GNU/Linux Tested a second time and system hung. Hadn't remoted in - working from desktop. Happened once before and was unable to restart GDM and shutdown hung too. Was able to examine logs and dmesg output and saw nothing unusual but may not have been looking in the right place. Had to remove power both times. Both 5G and 2.4G WiFi seem to be working well. Switching back and forth between them seems timely. 2022-04-03 repeating testing Setup: Recent install of bookworm install media. xzcat 20220121_raspi_4_bookworm.img.xz> /dev/sdf Install raspi-firmware from unstable (direct download) and network-manager and full upgrade of all bookworm packages. apt upgrade -y wget http://ftp.us.debian.org/debian/pool/non-free/r/raspi-firmware/raspi-firmware_1.20220328+ds-1_arm64.deb apt install ./raspi-firmware_1.20220328+ds-1_arm64.deb apt install network-manager Instructions for testing/managing WiFi using CLI HankB_, yes, from the command line, first, turn the wifi device on \"nmcli radio wifi on\" then list the wifi connections \"nmcli dev wifi list\", then sudo nmcli dev wifi connect network-ssid password \"network-password\" Test with 5.17.0-trunk-arm64 (ssh in via Ethernet) root@charm:~# nmcli radio wifi on root@charm:~# nmcli dev wifi list IN-USE BSSID SSID MODE CHAN RATE SIGNAL BARS SECURITY 70:4F:57:11:58:63 Nacho24 Infra 6 130 Mbit/s 100 **** WPA2 10:C3:7B:55:05:E8 Giant Voice System Infra 10 195 Mbit/s 97 **** WPA2 10:C3:7B:55:05:E9 NRO-33 Infra 10 195 Mbit/s 97 **** WPA2 70:4F:57:11:58:62 Nacho5G Infra 149 270 Mbit/s 77 *** WPA2 10:C3:7B:55:05:EC Fanghorn Forest Infra 157 405 Mbit/s 77 *** WPA2 root@charm:~# nmcli dev wifi connect \"Fanghorn Forest\" password \"elided\" Device 'wlan0' successfully activated with 'elided'. root@charm:~# ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff inet 192.168.1.103/24 brd 192.168.1.255 scope global dynamic eth0 valid_lft 5209sec preferred_lft 5209sec inet6 2601:249:1680:36f0:dea6:32ff:febf:65b5/64 scope global dynamic mngtmpaddr valid_lft 86390sec preferred_lft 14390sec inet6 fe80::dea6:32ff:febf:65b5/64 scope link valid_lft forever preferred_lft forever 3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b6 brd ff:ff:ff:ff:ff:ff inet 192.168.1.164/24 brd 192.168.1.255 scope global dynamic noprefixroute wlan0 valid_lft 7194sec preferred_lft 7194sec inet6 2601:249:1680:36f0::1a72/128 scope global dynamic noprefixroute valid_lft 7197sec preferred_lft 4497sec inet6 2601:249:1680:36f0:dd52:e503:3685:cb27/64 scope global dynamic noprefixroute valid_lft 86397sec preferred_lft 14397sec inet6 fe80::add9:ac99:37f5:fddb/64 scope link noprefixroute valid_lft forever preferred_lft forever root@charm:~# root@charm:~# root@charm:~# root@charm:~# ifdown eth0 Killed old client process Internet Systems Consortium DHCP Client 4.4.2-P1 Copyright 2004-2021 Internet Systems Consortium. All rights reserved. For info, please visit https://www.isc.org/software/dhcp/ Listening on LPF/eth0/dc:a6:32:bf:65:b5 Sending on LPF/eth0/dc:a6:32:bf:65:b5 Sending on Socket/fallback DHCPRELEASE of 192.168.1.103 on eth0 to 192.168.1.1 port 67 (This session was over Ethernet and resulted in a hung session following ifdown eth0 but I felt that was the easiest way to confirm that traffic was actually going over WiFi.) Reconnnect Linux charm 5.17.0-trunk-arm64 #1 SMP Debian 5.17.1-1~exp1 (2022-03-29) aarch64 GNU/Linux Kernels available root@charm:~# ls -l /boot/vmlinuz* -rw-r--r-- 1 root root 28614528 Dec 18 23:20 /boot/vmlinuz-5.15.0-2-arm64 -rw-r--r-- 1 root root 29998976 Mar 15 06:54 /boot/vmlinuz-5.16.0-5-arm64 -rw-r--r-- 1 root root 30003072 Mar 29 07:16 /boot/vmlinuz-5.17.0-trunk-arm64 root@charm:~# Test with 5.15.0-2-arm64 (ssh in via Ethernet) root@charm:~# uname -a Linux charm 5.15.0-2-arm64 #1 SMP Debian 5.15.5-2 (2021-12-18) aarch64 GNU/Linux root@charm:~# ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff inet 192.168.1.103/24 brd 192.168.1.255 scope global dynamic eth0 valid_lft 7136sec preferred_lft 7136sec inet6 2601:249:1680:36f0:dea6:32ff:febf:65b5/64 scope global dynamic mngtmpaddr valid_lft 86394sec preferred_lft 14394sec inet6 fe80::dea6:32ff:febf:65b5/64 scope link valid_lft forever preferred_lft forever root@charm:~# nmcli radio wifi on root@charm:~# nmcli dev wifi list root@charm:~# nmcli dev wifi connect \"Fanghorn Forest\" password \"elided\" Error: No Wi-Fi device found. root@charm:~# ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff inet 192.168.1.103/24 brd 192.168.1.255 scope global dynamic eth0 valid_lft 7098sec preferred_lft 7098sec inet6 2601:249:1680:36f0:dea6:32ff:febf:65b5/64 scope global dynamic mngtmpaddr valid_lft 86397sec preferred_lft 14397sec inet6 fe80::dea6:32ff:febf:65b5/64 scope link valid_lft forever preferred_lft forever root@charm:~# dmesg paste at https://paste.debian.net/1236660/ test with 5.16.0-5-arm64 starting with SSH over Ethernet root@charm:~# uname -a Linux charm 5.16.0-5-arm64 #1 SMP Debian 5.16.14-1 (2022-03-15) aarch64 GNU/Linux root@charm:~# ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff inet 192.168.1.103/24 brd 192.168.1.255 scope global dynamic eth0 valid_lft 7155sec preferred_lft 7155sec inet6 2601:249:1680:36f0:dea6:32ff:febf:65b5/64 scope global dynamic mngtmpaddr valid_lft 86389sec preferred_lft 14389sec inet6 fe80::dea6:32ff:febf:65b5/64 scope link valid_lft forever preferred_lft forever 3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b6 brd ff:ff:ff:ff:ff:ff inet 192.168.1.164/24 brd 192.168.1.255 scope global dynamic noprefixroute wlan0 valid_lft 5692sec preferred_lft 5692sec inet6 2601:249:1680:36f0::1a72/128 scope global dynamic noprefixroute valid_lft 5696sec preferred_lft 2996sec inet6 2601:249:1680:36f0:dd52:e503:3685:cb27/64 scope global dynamic noprefixroute valid_lft 86390sec preferred_lft 14390sec inet6 fe80::add9:ac99:37f5:fddb/64 scope link noprefixroute valid_lft forever preferred_lft forever root@charm:~# ifdown eth0 Killed old client process Internet Systems Consortium DHCP Client 4.4.2-P1 Copyright 2004-2021 Internet Systems Consortium. All rights reserved. For info, please visit https://www.isc.org/software/dhcp/ Listening on LPF/eth0/dc:a6:32:bf:65:b5 Sending on LPF/eth0/dc:a6:32:bf:65:b5 Sending on Socket/fallback DHCPRELEASE of 192.168.1.103 on eth0 to 192.168.1.1 port 67 Start second session over WiFi hbarta@charm:~$ ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST> mtu 1500 qdisc mq state DOWN group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff 3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b6 brd ff:ff:ff:ff:ff:ff inet 192.168.1.164/24 brd 192.168.1.255 scope global dynamic noprefixroute wlan0 valid_lft 5595sec preferred_lft 5595sec inet6 2601:249:1680:36f0::1a72/128 scope global dynamic noprefixroute valid_lft 5599sec preferred_lft 2899sec inet6 2601:249:1680:36f0:dd52:e503:3685:cb27/64 scope global dynamic noprefixroute valid_lft 86399sec preferred_lft 14399sec inet6 fe80::add9:ac99:37f5:fddb/64 scope link noprefixroute valid_lft forever preferred_lft forever hbarta@charm:~$ Confirmation that WiFi is working on both 5G (\"Fanghorn Forest\") and 2.4G (Giant Voice System) via WiFi ssh session. hbarta@charm:~$ nmcli dev wifi list IN-USE BSSID SSID MODE CHAN RATE SIGNAL BARS SECURITY 70:4F:57:11:58:63 Nacho24 Infra 6 130 Mbit/s 100 **** WPA2 10:C3:7B:55:05:E9 NRO-33 Infra 10 195 Mbit/s 100 **** WPA2 70:4F:57:11:58:62 Nacho5G Infra 149 270 Mbit/s 84 **** WPA2 * 10:C3:7B:55:05:E8 Giant Voice System Infra 10 195 Mbit/s 80 *** WPA2 10:C3:7B:55:05:EC Fanghorn Forest Infra 157 405 Mbit/s 75 *** WPA2 hbarta@charm:~$ su - root@charm:~# nmcli dev wifi connect \"Fanghorn Forest\" Device 'wlan0' successfully activated with '369ee301-096a-420b-99a9-68def48160f9'. root@charm:~# nmcli dev wifi list IN-USE BSSID SSID MODE CHAN RATE SIGNAL BARS SECURITY 70:4F:57:11:58:63 Nacho24 Infra 6 130 Mbit/s 100 **** WPA2 10:C3:7B:55:05:E9 NRO-33 Infra 10 195 Mbit/s 100 **** WPA2 10:C3:7B:55:05:E8 Giant Voice System Infra 10 195 Mbit/s 94 **** WPA2 70:4F:57:11:58:62 Nacho5G Infra 149 270 Mbit/s 79 *** WPA2 * 10:C3:7B:55:05:EC Fanghorn Forest Infra 157 405 Mbit/s 66 *** WPA2 root@charm:~# ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST> mtu 1500 qdisc mq state DOWN group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff 3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b6 brd ff:ff:ff:ff:ff:ff inet 192.168.1.164/24 brd 192.168.1.255 scope global dynamic noprefixroute wlan0 valid_lft 6825sec preferred_lft 6825sec inet6 2601:249:1680:36f0::1a72/128 scope global dynamic noprefixroute valid_lft 6827sec preferred_lft 4127sec inet6 2601:249:1680:36f0:dd52:e503:3685:cb27/64 scope global dynamic noprefixroute valid_lft 86401sec preferred_lft 14401sec inet6 fe80::add9:ac99:37f5:fddb/64 scope link noprefixroute valid_lft forever preferred_lft forever root@charm:~# uname -a Linux charm 5.17.0-trunk-arm64 #1 SMP Debian 5.17.1-1~exp1 (2022-03-29) aarch64 GNU/Linux root@charm:~#","title":"Testing networking (WiFi, ETH) Pi 4B"},{"location":"test-debug/Pi-4B-Bookworm-WiFi/#testing-networking-wifi-eth-pi-4b","text":"Testing the network interfaces on a Pi 4B running Debian Bookworm with available kernel packages. Following installation the `raspi-firmware1 package was held due to performance probnlems with the upgrade. All testing was performed with the firmware that came with the install media. Initial tests were hampered by two issues. I had mistyped the WiFi password causing connection attempts to fail. Ethernet was unmanaged and remained configured even when physically disconnected. This masked WiFi even though WiFi appeared to be associated (wlan0 had an IP address handed out by the local DHCP server.) I got the Ethernet under NetworkManager control and retyped the password and achieved some success with WiFi. Ethernet seemed to work without difficulty with all kernels.","title":"Testing networking (WiFi, ETH) Pi 4B"},{"location":"test-debug/Pi-4B-Bookworm-WiFi/#status","text":"I'm not happy with results, will retest when I have a chance (not till the weekend.)","title":"Status"},{"location":"test-debug/Pi-4B-Bookworm-WiFi/#5150-2-arm64","text":"This is the kernel that comes with the install media ( 20220121_raspi_4_bookworm.img.xz ). Linux up 5.15.0-2-arm64 #1 SMP Debian 5.15.5-2 (2021-12-18) aarch64 GNU/Linux No WiFi. dmesg capture at https://paste.debian.net/1236231/ No wlan0 in ip addr output. Ethernet seems to work OK.","title":"5.15.0-2-arm64"},{"location":"test-debug/Pi-4B-Bookworm-WiFi/#5160-5-arm64","text":"This is the kernel available in the repo to upgrade following installation. Linux up 5.16.0-5-arm64 #1 SMP Debian 5.16.14-1 (2022-03-15) aarch64 GNU/Linux WiFi works w/out difficulty on both 5G and 2.4G APs. Switching repeatedly between the two SSIDs takes less than ten seconds.","title":"5.16.0-5-arm64"},{"location":"test-debug/Pi-4B-Bookworm-WiFi/#5170-rc8-arm64","text":"Available from experimental Linux up 5.17.0-rc8-arm64 #1 SMP Debian 5.17~rc8-1~exp1 (2022-03-14) aarch64 GNU/Linux WiFi works on 5G, does not associate on 2.4G. Captured output to daemon.log when trying to switch from an associated 5G AP to a 2.4G AP up until NM re-requested the WiFi password. https://paste.debian.net/1236229/ Connect times to the 5G AP was quick at times and not quick other times. At one point it was necessary to turn WiFi off and on again to get it to associate. (Both 5G and 2.4G radios are on the same WiFi AP.) Did not shutdown cleanly. Had to pull power.","title":"5.17.0-rc8-arm64"},{"location":"test-debug/Pi-4B-Bookworm-WiFi/#5170-trunk-arm64","text":"From experimental Linux up 5.17.0-trunk-arm64 #1 SMP Debian 5.17.1-1~exp1 (2022-03-29) aarch64 GNU/Linux Tested a second time and system hung. Hadn't remoted in - working from desktop. Happened once before and was unable to restart GDM and shutdown hung too. Was able to examine logs and dmesg output and saw nothing unusual but may not have been looking in the right place. Had to remove power both times. Both 5G and 2.4G WiFi seem to be working well. Switching back and forth between them seems timely.","title":"5.17.0-trunk-arm64"},{"location":"test-debug/Pi-4B-Bookworm-WiFi/#2022-04-03-repeating-testing","text":"","title":"2022-04-03 repeating testing"},{"location":"test-debug/Pi-4B-Bookworm-WiFi/#setup-recent-install-of-bookworm-install-media","text":"xzcat 20220121_raspi_4_bookworm.img.xz> /dev/sdf Install raspi-firmware from unstable (direct download) and network-manager and full upgrade of all bookworm packages. apt upgrade -y wget http://ftp.us.debian.org/debian/pool/non-free/r/raspi-firmware/raspi-firmware_1.20220328+ds-1_arm64.deb apt install ./raspi-firmware_1.20220328+ds-1_arm64.deb apt install network-manager","title":"Setup: Recent install of bookworm install media."},{"location":"test-debug/Pi-4B-Bookworm-WiFi/#instructions-for-testingmanaging-wifi-using-cli","text":"HankB_, yes, from the command line, first, turn the wifi device on \"nmcli radio wifi on\" then list the wifi connections \"nmcli dev wifi list\", then sudo nmcli dev wifi connect network-ssid password \"network-password\" Test with 5.17.0-trunk-arm64 (ssh in via Ethernet) root@charm:~# nmcli radio wifi on root@charm:~# nmcli dev wifi list IN-USE BSSID SSID MODE CHAN RATE SIGNAL BARS SECURITY 70:4F:57:11:58:63 Nacho24 Infra 6 130 Mbit/s 100 **** WPA2 10:C3:7B:55:05:E8 Giant Voice System Infra 10 195 Mbit/s 97 **** WPA2 10:C3:7B:55:05:E9 NRO-33 Infra 10 195 Mbit/s 97 **** WPA2 70:4F:57:11:58:62 Nacho5G Infra 149 270 Mbit/s 77 *** WPA2 10:C3:7B:55:05:EC Fanghorn Forest Infra 157 405 Mbit/s 77 *** WPA2 root@charm:~# nmcli dev wifi connect \"Fanghorn Forest\" password \"elided\" Device 'wlan0' successfully activated with 'elided'. root@charm:~# ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff inet 192.168.1.103/24 brd 192.168.1.255 scope global dynamic eth0 valid_lft 5209sec preferred_lft 5209sec inet6 2601:249:1680:36f0:dea6:32ff:febf:65b5/64 scope global dynamic mngtmpaddr valid_lft 86390sec preferred_lft 14390sec inet6 fe80::dea6:32ff:febf:65b5/64 scope link valid_lft forever preferred_lft forever 3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b6 brd ff:ff:ff:ff:ff:ff inet 192.168.1.164/24 brd 192.168.1.255 scope global dynamic noprefixroute wlan0 valid_lft 7194sec preferred_lft 7194sec inet6 2601:249:1680:36f0::1a72/128 scope global dynamic noprefixroute valid_lft 7197sec preferred_lft 4497sec inet6 2601:249:1680:36f0:dd52:e503:3685:cb27/64 scope global dynamic noprefixroute valid_lft 86397sec preferred_lft 14397sec inet6 fe80::add9:ac99:37f5:fddb/64 scope link noprefixroute valid_lft forever preferred_lft forever root@charm:~# root@charm:~# root@charm:~# root@charm:~# ifdown eth0 Killed old client process Internet Systems Consortium DHCP Client 4.4.2-P1 Copyright 2004-2021 Internet Systems Consortium. All rights reserved. For info, please visit https://www.isc.org/software/dhcp/ Listening on LPF/eth0/dc:a6:32:bf:65:b5 Sending on LPF/eth0/dc:a6:32:bf:65:b5 Sending on Socket/fallback DHCPRELEASE of 192.168.1.103 on eth0 to 192.168.1.1 port 67 (This session was over Ethernet and resulted in a hung session following ifdown eth0 but I felt that was the easiest way to confirm that traffic was actually going over WiFi.) Reconnnect Linux charm 5.17.0-trunk-arm64 #1 SMP Debian 5.17.1-1~exp1 (2022-03-29) aarch64 GNU/Linux Kernels available root@charm:~# ls -l /boot/vmlinuz* -rw-r--r-- 1 root root 28614528 Dec 18 23:20 /boot/vmlinuz-5.15.0-2-arm64 -rw-r--r-- 1 root root 29998976 Mar 15 06:54 /boot/vmlinuz-5.16.0-5-arm64 -rw-r--r-- 1 root root 30003072 Mar 29 07:16 /boot/vmlinuz-5.17.0-trunk-arm64 root@charm:~# Test with 5.15.0-2-arm64 (ssh in via Ethernet) root@charm:~# uname -a Linux charm 5.15.0-2-arm64 #1 SMP Debian 5.15.5-2 (2021-12-18) aarch64 GNU/Linux root@charm:~# ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff inet 192.168.1.103/24 brd 192.168.1.255 scope global dynamic eth0 valid_lft 7136sec preferred_lft 7136sec inet6 2601:249:1680:36f0:dea6:32ff:febf:65b5/64 scope global dynamic mngtmpaddr valid_lft 86394sec preferred_lft 14394sec inet6 fe80::dea6:32ff:febf:65b5/64 scope link valid_lft forever preferred_lft forever root@charm:~# nmcli radio wifi on root@charm:~# nmcli dev wifi list root@charm:~# nmcli dev wifi connect \"Fanghorn Forest\" password \"elided\" Error: No Wi-Fi device found. root@charm:~# ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff inet 192.168.1.103/24 brd 192.168.1.255 scope global dynamic eth0 valid_lft 7098sec preferred_lft 7098sec inet6 2601:249:1680:36f0:dea6:32ff:febf:65b5/64 scope global dynamic mngtmpaddr valid_lft 86397sec preferred_lft 14397sec inet6 fe80::dea6:32ff:febf:65b5/64 scope link valid_lft forever preferred_lft forever root@charm:~# dmesg paste at https://paste.debian.net/1236660/","title":"Instructions for testing/managing WiFi using CLI"},{"location":"test-debug/Pi-4B-Bookworm-WiFi/#test-with-5160-5-arm64-starting-with-ssh-over-ethernet","text":"root@charm:~# uname -a Linux charm 5.16.0-5-arm64 #1 SMP Debian 5.16.14-1 (2022-03-15) aarch64 GNU/Linux root@charm:~# ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff inet 192.168.1.103/24 brd 192.168.1.255 scope global dynamic eth0 valid_lft 7155sec preferred_lft 7155sec inet6 2601:249:1680:36f0:dea6:32ff:febf:65b5/64 scope global dynamic mngtmpaddr valid_lft 86389sec preferred_lft 14389sec inet6 fe80::dea6:32ff:febf:65b5/64 scope link valid_lft forever preferred_lft forever 3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b6 brd ff:ff:ff:ff:ff:ff inet 192.168.1.164/24 brd 192.168.1.255 scope global dynamic noprefixroute wlan0 valid_lft 5692sec preferred_lft 5692sec inet6 2601:249:1680:36f0::1a72/128 scope global dynamic noprefixroute valid_lft 5696sec preferred_lft 2996sec inet6 2601:249:1680:36f0:dd52:e503:3685:cb27/64 scope global dynamic noprefixroute valid_lft 86390sec preferred_lft 14390sec inet6 fe80::add9:ac99:37f5:fddb/64 scope link noprefixroute valid_lft forever preferred_lft forever root@charm:~# ifdown eth0 Killed old client process Internet Systems Consortium DHCP Client 4.4.2-P1 Copyright 2004-2021 Internet Systems Consortium. All rights reserved. For info, please visit https://www.isc.org/software/dhcp/ Listening on LPF/eth0/dc:a6:32:bf:65:b5 Sending on LPF/eth0/dc:a6:32:bf:65:b5 Sending on Socket/fallback DHCPRELEASE of 192.168.1.103 on eth0 to 192.168.1.1 port 67 Start second session over WiFi hbarta@charm:~$ ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST> mtu 1500 qdisc mq state DOWN group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff 3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b6 brd ff:ff:ff:ff:ff:ff inet 192.168.1.164/24 brd 192.168.1.255 scope global dynamic noprefixroute wlan0 valid_lft 5595sec preferred_lft 5595sec inet6 2601:249:1680:36f0::1a72/128 scope global dynamic noprefixroute valid_lft 5599sec preferred_lft 2899sec inet6 2601:249:1680:36f0:dd52:e503:3685:cb27/64 scope global dynamic noprefixroute valid_lft 86399sec preferred_lft 14399sec inet6 fe80::add9:ac99:37f5:fddb/64 scope link noprefixroute valid_lft forever preferred_lft forever hbarta@charm:~$ Confirmation that WiFi is working on both 5G (\"Fanghorn Forest\") and 2.4G (Giant Voice System) via WiFi ssh session. hbarta@charm:~$ nmcli dev wifi list IN-USE BSSID SSID MODE CHAN RATE SIGNAL BARS SECURITY 70:4F:57:11:58:63 Nacho24 Infra 6 130 Mbit/s 100 **** WPA2 10:C3:7B:55:05:E9 NRO-33 Infra 10 195 Mbit/s 100 **** WPA2 70:4F:57:11:58:62 Nacho5G Infra 149 270 Mbit/s 84 **** WPA2 * 10:C3:7B:55:05:E8 Giant Voice System Infra 10 195 Mbit/s 80 *** WPA2 10:C3:7B:55:05:EC Fanghorn Forest Infra 157 405 Mbit/s 75 *** WPA2 hbarta@charm:~$ su - root@charm:~# nmcli dev wifi connect \"Fanghorn Forest\" Device 'wlan0' successfully activated with '369ee301-096a-420b-99a9-68def48160f9'. root@charm:~# nmcli dev wifi list IN-USE BSSID SSID MODE CHAN RATE SIGNAL BARS SECURITY 70:4F:57:11:58:63 Nacho24 Infra 6 130 Mbit/s 100 **** WPA2 10:C3:7B:55:05:E9 NRO-33 Infra 10 195 Mbit/s 100 **** WPA2 10:C3:7B:55:05:E8 Giant Voice System Infra 10 195 Mbit/s 94 **** WPA2 70:4F:57:11:58:62 Nacho5G Infra 149 270 Mbit/s 79 *** WPA2 * 10:C3:7B:55:05:EC Fanghorn Forest Infra 157 405 Mbit/s 66 *** WPA2 root@charm:~# ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST> mtu 1500 qdisc mq state DOWN group default qlen 1000 link/ether dc:a6:32:bf:65:b5 brd ff:ff:ff:ff:ff:ff 3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether dc:a6:32:bf:65:b6 brd ff:ff:ff:ff:ff:ff inet 192.168.1.164/24 brd 192.168.1.255 scope global dynamic noprefixroute wlan0 valid_lft 6825sec preferred_lft 6825sec inet6 2601:249:1680:36f0::1a72/128 scope global dynamic noprefixroute valid_lft 6827sec preferred_lft 4127sec inet6 2601:249:1680:36f0:dd52:e503:3685:cb27/64 scope global dynamic noprefixroute valid_lft 86401sec preferred_lft 14401sec inet6 fe80::add9:ac99:37f5:fddb/64 scope link noprefixroute valid_lft forever preferred_lft forever root@charm:~# uname -a Linux charm 5.17.0-trunk-arm64 #1 SMP Debian 5.17.1-1~exp1 (2022-03-29) aarch64 GNU/Linux root@charm:~#","title":"test with 5.16.0-5-arm64 starting with SSH over Ethernet"},{"location":"test-debug/Pi-4B-firmware/","text":"Firmware issue raspi-firmware Debian Bookworm https://github.com/raspberrypi/firmware/issues/1705 Forwarded to Debian - https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1007719 2022-04-03 test tagged release Previous testing established that the latest firmware pulled from master did not exhibit this problem. That is now pulled into a tagged release 1.2022-328 https://github.com/raspberrypi/firmware/archive/refs/tags/1.20220328.tar.gz I have a Pi 4B/8GH with Bookworm (with task-gnome-desktop ) installed and with the following kernels: hbarta@up:~$ ls -l /boot/vmlinuz* -rw-r--r-- 1 root root 28614528 Dec 18 23:20 /boot/vmlinuz-5.15.0-2-arm64 -rw-r--r-- 1 root root 29998976 Mar 15 06:54 /boot/vmlinuz-5.16.0-5-arm64 -rw-r--r-- 1 root root 30001664 Mar 14 06:04 /boot/vmlinuz-5.17.0-rc8-arm64 -rw-r--r-- 1 root root 30003072 Mar 29 07:16 /boot/vmlinuz-5.17.0-trunk-arm64 hbarta@up:~$ Testing will be performed with the tagged firmware on all kernels. The following command will be used to determine if the issue exists. cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies vcdbg downloaded from https://drive.google.com/file/d/1HS9E5vnxxNqrizB4mEYrnFoQQ1axSRKm/view?usp=sharing is used to confirm firmware version. Procedure Download and extract the frmware tarball. cd firmware-1.20220328/boot cp bootcode.bin *.dat *.elf /boot/firmware Edit /boot/firmware/config.txt to select trhe desired kernel Reboot and check results. Firmware prior to starting test/ root@up:~# vcdbg version vcos_build_version = 40787ee5905644f639a2a0f6e00ae12e517a2211 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Aug 3 2021 vcos_build_time = 18:14:56 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@up:~# Testing Attempts to use the older kernels (5.15.6, 5.16.0) were unsuccessful because the installation of one of the more recent kernels apparently purged those. Instead the existing 5.17.0-trunk-arm64 kernel will be tested with the tagged tarball and then testing will be performed with a fresh install and the raspi-firmware in the Bookworm repo. root@up:~# uname -a Linux up 5.17.0-trunk-arm64 #1 SMP Debian 5.17.1-1~exp1 (2022-03-29) aarch64 GNU/Linux root@up:~# cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies 600000 700000 800000 900000 1000000 1100000 1200000 1300000 1400000 1500000 root@up:~# vcdbg version vcos_build_version = e5a963efa66a1974127860b42e913d2374139ff5 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Mar 24 2022 vcos_build_time = 13:19:26 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@up:~# Fresh install xzcat 20220121_raspi_4_bookworm.img.xz> /dev/sdf boot adduser hbarta hostnamectl set-hostname charm apt update reboot, copy vcdbg root@charm:~# uname -a Linux charm 5.15.0-2-arm64 #1 SMP Debian 5.15.5-2 (2021-12-18) aarch64 GNU/Linux root@charm:~# cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies 600000 700000 800000 900000 1000000 1100000 1200000 1300000 1400000 1500000 root@charm:~# ./vcdbg version vcos_build_version = 40787ee5905644f639a2a0f6e00ae12e517a2211 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Aug 3 2021 vcos_build_time = 18:14:56 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@charm:~# Upgrade raspi-firmware only. root@charm:~# apt install raspi-firmware Reading package lists... Done Building dependency tree... Done Reading state information... Done The following packages will be upgraded: raspi-firmware 1 upgraded, 0 newly installed, 0 to remove and 110 not upgraded. Need to get 4548 kB of archives. After this operation, 31.7 kB of additional disk space will be used. Get:1 http://deb.debian.org/debian bookworm/non-free arm64 raspi-firmware arm64 1.20220120+ds-1 [4548 kB] Fetched 4548 kB in 2s (2976 kB/s) (Reading database ... 18717 files and directories currently installed.) Preparing to unpack .../raspi-firmware_1.20220120+ds-1_arm64.deb ... Unpacking raspi-firmware (1.20220120+ds-1) over (1.20210805+ds-1) ... Setting up raspi-firmware (1.20220120+ds-1) ... Configuration file '/etc/default/raspi-firmware' ==> Modified (by you or by a script) since installation. ==> Package distributor has shipped an updated version. What would you like to do about it ? Your options are: Y or I : install the package maintainer's version N or O : keep your currently-installed version D : show the differences between the versions Z : start a shell to examine the situation The default action is to keep your current version. *** raspi-firmware (Y/I/N/O/D/Z) [default=N] ? D --- /etc/default/raspi-firmware 2022-01-21 08:41:33.325239447 +0000 +++ /etc/default/raspi-firmware.dpkg-new 2022-02-11 05:33:01.000000000 +0000 @@ -25,7 +25,7 @@ # but you can specify otherwise, including booting by partition label # (i.e. ROOTPART=\"LABEL=root\") # -ROOTPART=LABEL=RASPIROOT +#ROOTPART=/dev/mmcblk0p2 # Main baremetal application that is started by the firmware once the # hardware has been initialized. Usually, this is the Linux kernel but @@ -73,7 +73,7 @@ # which drives the serial ports) gets its clock from the GPU, as # explained here: # -# https://www.raspberrypi.org/documentation/configuration/uart.md +# https://www.raspberrypi.com/documentation/computers/configuration.html#mini-uart-and-cpu-core-frequency # # The clock speeds the RPi4 GPU uses are 360/500/550 MHz. If you # intend to use the serial console, you need to set GPU_FREQ to @@ -98,7 +98,7 @@ # Create a file \"/etc/default/raspi-firmware-custom\" to add custom parameter # to startup the kernel. Maybe not all options are supported. -# (see https://www.raspberrypi.org/documentation/configuration/config-txt/) +# (see https://www.raspberrypi.com/documentation/computers/config_txt.html) # # To pass extra arbitrary parameters to the kernel at boot, you can specify # them in \"/etc/default/raspi-extra-cmdline\". Keep in mind they should be Configuration file '/etc/default/raspi-firmware' ==> Modified (by you or by a script) since installation. ==> Package distributor has shipped an updated version. What would you like to do about it ? Your options are: Y or I : install the package maintainer's version N or O : keep your currently-installed version D : show the differences between the versions Z : start a shell to examine the situation The default action is to keep your current version. *** raspi-firmware (Y/I/N/O/D/Z) [default=N] ? Y Installing new version of config file /etc/default/raspi-firmware ... Installing new version of config file /etc/kernel/postinst.d/z50-raspi-firmware ... Processing triggers for initramfs-tools (0.140) ... update-initramfs: Generating /boot/initrd.img-5.15.0-2-arm64 root@charm:~# Reboot root@charm:~# uname -a Linux charm 5.15.0-2-arm64 #1 SMP Debian 5.15.5-2 (2021-12-18) aarch64 GNU/Linux root@charm:~# cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies cat: /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies: No such file or directory root@charm:~# dpkg -l | grep raspi-firmware ii raspi-firmware 1.20220120+ds-1 arm64 Raspberry Pi family GPU firmware and bootloaders root@charm:~# ./vcdbg version vcos_build_version = bd88f66f8952d34e4e0613a85c7a6d3da49e13e2 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Jan 20 2022 vcos_build_time = 13:56:48 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@charm:~# Wrong package. wget http://ftp.us.debian.org/debian/pool/non-free/r/raspi-firmware/raspi-firmware_1.20220328+ds-1_arm64.deb root@charm:~# apt install ./raspi-firmware_1.20220328+ds-1_arm64.deb Reading package lists... Done Building dependency tree... Done Reading state information... Done Note, selecting 'raspi-firmware' instead of './raspi-firmware_1.20220328+ds-1_arm64.deb' The following packages will be upgraded: raspi-firmware 1 upgraded, 0 newly installed, 0 to remove and 110 not upgraded. Need to get 0 B/4551 kB of archives. After this operation, 8192 B of additional disk space will be used. Get:1 /root/raspi-firmware_1.20220328+ds-1_arm64.deb raspi-firmware arm64 1.20220328+ds-1 [4551 kB] (Reading database ... 18717 files and directories currently installed.) Preparing to unpack .../raspi-firmware_1.20220328+ds-1_arm64.deb ... Unpacking raspi-firmware (1.20220328+ds-1) over (1.20220120+ds-1) ... Setting up raspi-firmware (1.20220328+ds-1) ... Processing triggers for initramfs-tools (0.140) ... update-initramfs: Generating /boot/initrd.img-5.15.0-2-arm64 N: Download is performed unsandboxed as root as file '/root/raspi-firmware_1.20220328+ds-1_arm64.deb' couldn't be accessed by user '_apt'. - pkgAcquire::Run (13: Permission denied) root@charm:~# reboot hbarta@charm:~$ uname -a Linux charm 5.15.0-2-arm64 #1 SMP Debian 5.15.5-2 (2021-12-18) aarch64 GNU/Linux hbarta@charm:~$ cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies 600000 700000 800000 900000 1000000 1100000 1200000 1300000 1400000 1500000 hbarta@charm:~$ su - root@charm:~# ./vcdbg version vcos_build_version = e5a963efa66a1974127860b42e913d2374139ff5 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Mar 24 2022 vcos_build_time = 13:19:26 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@charm:~# Perform full upgrade and reboot 110 upgraded, 3 newly installed, 0 to remove and 0 not upgraded. hbarta@charm:~$ uname -a Linux charm 5.16.0-5-arm64 #1 SMP Debian 5.16.14-1 (2022-03-15) aarch64 GNU/Linux hbarta@charm:~$ cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies 600000 700000 800000 900000 1000000 1100000 1200000 1300000 1400000 1500000 hbarta@charm:~$ su - root@charm:~# ./vcdbg version vcos_build_version = e5a963efa66a1974127860b42e913d2374139ff5 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Mar 24 2022 vcos_build_time = 13:19:26 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@charm:~# Install with kernel from experimental root@charm:~# cat /etc/apt/preferences.d/linux-kernel Package: * Pin: release o=Debian,a=experimental Pin-Priority: 102 root@up:~# apt policy Package files: 100 /var/lib/dpkg/status release a=now 500 http://deb.debian.org/debian bookworm/non-free arm64 Packages release o=Debian,a=testing,n=bookworm,l=Debian,c=non-free,b=arm64 origin deb.debian.org 500 http://deb.debian.org/debian bookworm/contrib arm64 Packages release o=Debian,a=testing,n=bookworm,l=Debian,c=contrib,b=arm64 origin deb.debian.org 500 http://deb.debian.org/debian bookworm/main arm64 Packages release o=Debian,a=testing,n=bookworm,l=Debian,c=main,b=arm64 origin deb.debian.org Pinned packages: root@charm:~# root@charm:~# root@charm:~# echo \"deb http://deb.debian.org/debian experimental main\" >> /etc/apt/sources.list root@charm:~# apt update Hit:1 http://deb.debian.org/debian bookworm InRelease Hit:2 http://security.debian.org/debian-security bookworm-security InRelease Get:3 http://deb.debian.org/debian experimental InRelease [75.4 kB] Get:4 http://deb.debian.org/debian experimental/main arm64 Packages [369 kB] Get:5 http://deb.debian.org/debian experimental/main Translation-en [232 kB] Fetched 677 kB in 3s (250 kB/s) Reading package lists... Done Building dependency tree... Done Reading state information... Done All packages are up to date. root@charm:~# apt install -t experimental linux-image-5.17.0-trunk-arm64 Reading package lists... Done Building dependency tree... Done Reading state information... Done Suggested packages: linux-doc-5.17 debian-kernel-handbook The following NEW packages will be installed: linux-image-5.17.0-trunk-arm64 0 upgraded, 1 newly installed, 0 to remove and 16 not upgraded. Need to get 58.6 MB of archives. After this operation, 406 MB of additional disk space will be used. Get:1 http://deb.debian.org/debian experimental/main arm64 linux-image-5.17.0-trunk-arm64 arm64 5.17.1-1~exp1 [58.6 MB] Fetched 58.6 MB in 4s (13.8 MB/s) Selecting previously unselected package linux-image-5.17.0-trunk-arm64. (Reading database ... 23590 files and directories currently installed.) Preparing to unpack .../linux-image-5.17.0-trunk-arm64_5.17.1-1~exp1_arm64.deb ... Unpacking linux-image-5.17.0-trunk-arm64 (5.17.1-1~exp1) ... Setting up linux-image-5.17.0-trunk-arm64 (5.17.1-1~exp1) ... I: /vmlinuz.old is now a symlink to boot/vmlinuz-5.16.0-5-arm64 I: /initrd.img.old is now a symlink to boot/initrd.img-5.16.0-5-arm64 I: /vmlinuz is now a symlink to boot/vmlinuz-5.17.0-trunk-arm64 I: /initrd.img is now a symlink to boot/initrd.img-5.17.0-trunk-arm64 /etc/kernel/postinst.d/initramfs-tools: update-initramfs: Generating /boot/initrd.img-5.17.0-trunk-arm64 root@charm:~# Note: Results of following apt policy command were inadvertently copied into /etc/apt/preferences.d/linux-kernel but seem to be ignored by apt or at least did not prevent the desired operation. Reboot hbarta@charm:~$ uname -a Linux charm 5.17.0-trunk-arm64 #1 SMP Debian 5.17.1-1~exp1 (2022-03-29) aarch64 GNU/Linux hbarta@charm:~$ cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies 600000 700000 800000 900000 1000000 1100000 1200000 1300000 1400000 1500000 hbarta@charm:~$ su - root@charm:~# ./vcdbg version vcos_build_version = e5a963efa66a1974127860b42e913d2374139ff5 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Mar 24 2022 vcos_build_time = 13:19:26 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@charm:~#","title":"Firmware issue raspi-firmware Debian Bookworm"},{"location":"test-debug/Pi-4B-firmware/#firmware-issue-raspi-firmware-debian-bookworm","text":"https://github.com/raspberrypi/firmware/issues/1705 Forwarded to Debian - https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1007719","title":"Firmware issue raspi-firmware Debian Bookworm"},{"location":"test-debug/Pi-4B-firmware/#2022-04-03-test-tagged-release","text":"Previous testing established that the latest firmware pulled from master did not exhibit this problem. That is now pulled into a tagged release 1.2022-328 https://github.com/raspberrypi/firmware/archive/refs/tags/1.20220328.tar.gz I have a Pi 4B/8GH with Bookworm (with task-gnome-desktop ) installed and with the following kernels: hbarta@up:~$ ls -l /boot/vmlinuz* -rw-r--r-- 1 root root 28614528 Dec 18 23:20 /boot/vmlinuz-5.15.0-2-arm64 -rw-r--r-- 1 root root 29998976 Mar 15 06:54 /boot/vmlinuz-5.16.0-5-arm64 -rw-r--r-- 1 root root 30001664 Mar 14 06:04 /boot/vmlinuz-5.17.0-rc8-arm64 -rw-r--r-- 1 root root 30003072 Mar 29 07:16 /boot/vmlinuz-5.17.0-trunk-arm64 hbarta@up:~$ Testing will be performed with the tagged firmware on all kernels. The following command will be used to determine if the issue exists. cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies vcdbg downloaded from https://drive.google.com/file/d/1HS9E5vnxxNqrizB4mEYrnFoQQ1axSRKm/view?usp=sharing is used to confirm firmware version. Procedure Download and extract the frmware tarball. cd firmware-1.20220328/boot cp bootcode.bin *.dat *.elf /boot/firmware Edit /boot/firmware/config.txt to select trhe desired kernel Reboot and check results. Firmware prior to starting test/ root@up:~# vcdbg version vcos_build_version = 40787ee5905644f639a2a0f6e00ae12e517a2211 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Aug 3 2021 vcos_build_time = 18:14:56 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@up:~#","title":"2022-04-03 test tagged release"},{"location":"test-debug/Pi-4B-firmware/#testing","text":"Attempts to use the older kernels (5.15.6, 5.16.0) were unsuccessful because the installation of one of the more recent kernels apparently purged those. Instead the existing 5.17.0-trunk-arm64 kernel will be tested with the tagged tarball and then testing will be performed with a fresh install and the raspi-firmware in the Bookworm repo. root@up:~# uname -a Linux up 5.17.0-trunk-arm64 #1 SMP Debian 5.17.1-1~exp1 (2022-03-29) aarch64 GNU/Linux root@up:~# cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies 600000 700000 800000 900000 1000000 1100000 1200000 1300000 1400000 1500000 root@up:~# vcdbg version vcos_build_version = e5a963efa66a1974127860b42e913d2374139ff5 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Mar 24 2022 vcos_build_time = 13:19:26 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@up:~#","title":"Testing"},{"location":"test-debug/Pi-4B-firmware/#fresh-install","text":"xzcat 20220121_raspi_4_bookworm.img.xz> /dev/sdf boot adduser hbarta hostnamectl set-hostname charm apt update reboot, copy vcdbg root@charm:~# uname -a Linux charm 5.15.0-2-arm64 #1 SMP Debian 5.15.5-2 (2021-12-18) aarch64 GNU/Linux root@charm:~# cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies 600000 700000 800000 900000 1000000 1100000 1200000 1300000 1400000 1500000 root@charm:~# ./vcdbg version vcos_build_version = 40787ee5905644f639a2a0f6e00ae12e517a2211 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Aug 3 2021 vcos_build_time = 18:14:56 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@charm:~# Upgrade raspi-firmware only. root@charm:~# apt install raspi-firmware Reading package lists... Done Building dependency tree... Done Reading state information... Done The following packages will be upgraded: raspi-firmware 1 upgraded, 0 newly installed, 0 to remove and 110 not upgraded. Need to get 4548 kB of archives. After this operation, 31.7 kB of additional disk space will be used. Get:1 http://deb.debian.org/debian bookworm/non-free arm64 raspi-firmware arm64 1.20220120+ds-1 [4548 kB] Fetched 4548 kB in 2s (2976 kB/s) (Reading database ... 18717 files and directories currently installed.) Preparing to unpack .../raspi-firmware_1.20220120+ds-1_arm64.deb ... Unpacking raspi-firmware (1.20220120+ds-1) over (1.20210805+ds-1) ... Setting up raspi-firmware (1.20220120+ds-1) ... Configuration file '/etc/default/raspi-firmware' ==> Modified (by you or by a script) since installation. ==> Package distributor has shipped an updated version. What would you like to do about it ? Your options are: Y or I : install the package maintainer's version N or O : keep your currently-installed version D : show the differences between the versions Z : start a shell to examine the situation The default action is to keep your current version. *** raspi-firmware (Y/I/N/O/D/Z) [default=N] ? D --- /etc/default/raspi-firmware 2022-01-21 08:41:33.325239447 +0000 +++ /etc/default/raspi-firmware.dpkg-new 2022-02-11 05:33:01.000000000 +0000 @@ -25,7 +25,7 @@ # but you can specify otherwise, including booting by partition label # (i.e. ROOTPART=\"LABEL=root\") # -ROOTPART=LABEL=RASPIROOT +#ROOTPART=/dev/mmcblk0p2 # Main baremetal application that is started by the firmware once the # hardware has been initialized. Usually, this is the Linux kernel but @@ -73,7 +73,7 @@ # which drives the serial ports) gets its clock from the GPU, as # explained here: # -# https://www.raspberrypi.org/documentation/configuration/uart.md +# https://www.raspberrypi.com/documentation/computers/configuration.html#mini-uart-and-cpu-core-frequency # # The clock speeds the RPi4 GPU uses are 360/500/550 MHz. If you # intend to use the serial console, you need to set GPU_FREQ to @@ -98,7 +98,7 @@ # Create a file \"/etc/default/raspi-firmware-custom\" to add custom parameter # to startup the kernel. Maybe not all options are supported. -# (see https://www.raspberrypi.org/documentation/configuration/config-txt/) +# (see https://www.raspberrypi.com/documentation/computers/config_txt.html) # # To pass extra arbitrary parameters to the kernel at boot, you can specify # them in \"/etc/default/raspi-extra-cmdline\". Keep in mind they should be Configuration file '/etc/default/raspi-firmware' ==> Modified (by you or by a script) since installation. ==> Package distributor has shipped an updated version. What would you like to do about it ? Your options are: Y or I : install the package maintainer's version N or O : keep your currently-installed version D : show the differences between the versions Z : start a shell to examine the situation The default action is to keep your current version. *** raspi-firmware (Y/I/N/O/D/Z) [default=N] ? Y Installing new version of config file /etc/default/raspi-firmware ... Installing new version of config file /etc/kernel/postinst.d/z50-raspi-firmware ... Processing triggers for initramfs-tools (0.140) ... update-initramfs: Generating /boot/initrd.img-5.15.0-2-arm64 root@charm:~# Reboot root@charm:~# uname -a Linux charm 5.15.0-2-arm64 #1 SMP Debian 5.15.5-2 (2021-12-18) aarch64 GNU/Linux root@charm:~# cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies cat: /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies: No such file or directory root@charm:~# dpkg -l | grep raspi-firmware ii raspi-firmware 1.20220120+ds-1 arm64 Raspberry Pi family GPU firmware and bootloaders root@charm:~# ./vcdbg version vcos_build_version = bd88f66f8952d34e4e0613a85c7a6d3da49e13e2 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Jan 20 2022 vcos_build_time = 13:56:48 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@charm:~# Wrong package. wget http://ftp.us.debian.org/debian/pool/non-free/r/raspi-firmware/raspi-firmware_1.20220328+ds-1_arm64.deb root@charm:~# apt install ./raspi-firmware_1.20220328+ds-1_arm64.deb Reading package lists... Done Building dependency tree... Done Reading state information... Done Note, selecting 'raspi-firmware' instead of './raspi-firmware_1.20220328+ds-1_arm64.deb' The following packages will be upgraded: raspi-firmware 1 upgraded, 0 newly installed, 0 to remove and 110 not upgraded. Need to get 0 B/4551 kB of archives. After this operation, 8192 B of additional disk space will be used. Get:1 /root/raspi-firmware_1.20220328+ds-1_arm64.deb raspi-firmware arm64 1.20220328+ds-1 [4551 kB] (Reading database ... 18717 files and directories currently installed.) Preparing to unpack .../raspi-firmware_1.20220328+ds-1_arm64.deb ... Unpacking raspi-firmware (1.20220328+ds-1) over (1.20220120+ds-1) ... Setting up raspi-firmware (1.20220328+ds-1) ... Processing triggers for initramfs-tools (0.140) ... update-initramfs: Generating /boot/initrd.img-5.15.0-2-arm64 N: Download is performed unsandboxed as root as file '/root/raspi-firmware_1.20220328+ds-1_arm64.deb' couldn't be accessed by user '_apt'. - pkgAcquire::Run (13: Permission denied) root@charm:~# reboot hbarta@charm:~$ uname -a Linux charm 5.15.0-2-arm64 #1 SMP Debian 5.15.5-2 (2021-12-18) aarch64 GNU/Linux hbarta@charm:~$ cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies 600000 700000 800000 900000 1000000 1100000 1200000 1300000 1400000 1500000 hbarta@charm:~$ su - root@charm:~# ./vcdbg version vcos_build_version = e5a963efa66a1974127860b42e913d2374139ff5 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Mar 24 2022 vcos_build_time = 13:19:26 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@charm:~# Perform full upgrade and reboot 110 upgraded, 3 newly installed, 0 to remove and 0 not upgraded. hbarta@charm:~$ uname -a Linux charm 5.16.0-5-arm64 #1 SMP Debian 5.16.14-1 (2022-03-15) aarch64 GNU/Linux hbarta@charm:~$ cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies 600000 700000 800000 900000 1000000 1100000 1200000 1300000 1400000 1500000 hbarta@charm:~$ su - root@charm:~# ./vcdbg version vcos_build_version = e5a963efa66a1974127860b42e913d2374139ff5 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Mar 24 2022 vcos_build_time = 13:19:26 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@charm:~# Install with kernel from experimental root@charm:~# cat /etc/apt/preferences.d/linux-kernel Package: * Pin: release o=Debian,a=experimental Pin-Priority: 102 root@up:~# apt policy Package files: 100 /var/lib/dpkg/status release a=now 500 http://deb.debian.org/debian bookworm/non-free arm64 Packages release o=Debian,a=testing,n=bookworm,l=Debian,c=non-free,b=arm64 origin deb.debian.org 500 http://deb.debian.org/debian bookworm/contrib arm64 Packages release o=Debian,a=testing,n=bookworm,l=Debian,c=contrib,b=arm64 origin deb.debian.org 500 http://deb.debian.org/debian bookworm/main arm64 Packages release o=Debian,a=testing,n=bookworm,l=Debian,c=main,b=arm64 origin deb.debian.org Pinned packages: root@charm:~# root@charm:~# root@charm:~# echo \"deb http://deb.debian.org/debian experimental main\" >> /etc/apt/sources.list root@charm:~# apt update Hit:1 http://deb.debian.org/debian bookworm InRelease Hit:2 http://security.debian.org/debian-security bookworm-security InRelease Get:3 http://deb.debian.org/debian experimental InRelease [75.4 kB] Get:4 http://deb.debian.org/debian experimental/main arm64 Packages [369 kB] Get:5 http://deb.debian.org/debian experimental/main Translation-en [232 kB] Fetched 677 kB in 3s (250 kB/s) Reading package lists... Done Building dependency tree... Done Reading state information... Done All packages are up to date. root@charm:~# apt install -t experimental linux-image-5.17.0-trunk-arm64 Reading package lists... Done Building dependency tree... Done Reading state information... Done Suggested packages: linux-doc-5.17 debian-kernel-handbook The following NEW packages will be installed: linux-image-5.17.0-trunk-arm64 0 upgraded, 1 newly installed, 0 to remove and 16 not upgraded. Need to get 58.6 MB of archives. After this operation, 406 MB of additional disk space will be used. Get:1 http://deb.debian.org/debian experimental/main arm64 linux-image-5.17.0-trunk-arm64 arm64 5.17.1-1~exp1 [58.6 MB] Fetched 58.6 MB in 4s (13.8 MB/s) Selecting previously unselected package linux-image-5.17.0-trunk-arm64. (Reading database ... 23590 files and directories currently installed.) Preparing to unpack .../linux-image-5.17.0-trunk-arm64_5.17.1-1~exp1_arm64.deb ... Unpacking linux-image-5.17.0-trunk-arm64 (5.17.1-1~exp1) ... Setting up linux-image-5.17.0-trunk-arm64 (5.17.1-1~exp1) ... I: /vmlinuz.old is now a symlink to boot/vmlinuz-5.16.0-5-arm64 I: /initrd.img.old is now a symlink to boot/initrd.img-5.16.0-5-arm64 I: /vmlinuz is now a symlink to boot/vmlinuz-5.17.0-trunk-arm64 I: /initrd.img is now a symlink to boot/initrd.img-5.17.0-trunk-arm64 /etc/kernel/postinst.d/initramfs-tools: update-initramfs: Generating /boot/initrd.img-5.17.0-trunk-arm64 root@charm:~# Note: Results of following apt policy command were inadvertently copied into /etc/apt/preferences.d/linux-kernel but seem to be ignored by apt or at least did not prevent the desired operation. Reboot hbarta@charm:~$ uname -a Linux charm 5.17.0-trunk-arm64 #1 SMP Debian 5.17.1-1~exp1 (2022-03-29) aarch64 GNU/Linux hbarta@charm:~$ cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies 600000 700000 800000 900000 1000000 1100000 1200000 1300000 1400000 1500000 hbarta@charm:~$ su - root@charm:~# ./vcdbg version vcos_build_version = e5a963efa66a1974127860b42e913d2374139ff5 (clean) vcos_build_branch = bcm2711_2 debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_application' vcos_build_application = ? vcos_build_date = Mar 24 2022 vcos_build_time = 13:19:26 vcos_build_user = dom vcos_build_hostname = buildbot vcos_build_platform = raspberrypi_linux debug_sym: ReadVideoCoreMemoryBySymbol: Symbol not found: 'vcos_build_type' vcos_build_type = ? root@charm:~#","title":"Fresh install"}]}