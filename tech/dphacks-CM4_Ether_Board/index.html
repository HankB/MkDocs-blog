<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>dphacks CM4 Ether Board - Hank's public Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Hank's public Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Hank's Docs home page</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Food</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../food/bean-dip/" class="dropdown-item">Bean Dip</a>
</li>
                                    
<li>
    <a href="../../food/peach-cobbler/" class="dropdown-item">Peach Cobbler from scratch</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Tech</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Debian_ZFS_on_root_to_a_new_drive/" class="dropdown-item">Debian Root on ZFS to a new drive</a>
</li>
                                    
<li>
    <a href="../Debian_on_downstream_kernel.01/" class="dropdown-item">Debian on downstream kernel Part 1</a>
</li>
                                    
<li>
    <a href="../Debian_on_downstream_kernel.02/" class="dropdown-item">Debian on downstream kernel Part 2</a>
</li>
                                    
<li>
    <a href="../ESP8266-RTOS-SDK_on_Debian/" class="dropdown-item">Using ESP8266-RTOS-SDK on Debian</a>
</li>
                                    
<li>
    <a href="../NVME_performance-Bicool_Mini_Base-vs-IO_Board/" class="dropdown-item">Pi CM4 NVME performance: Bicool Mini Base vs. IO Board</a>
</li>
                                    
<li>
    <a href="../OWI-535-Robot_Arm_Control_assembly/" class="dropdown-item">OWI-535 Robot Arm Control assembly</a>
</li>
                                    
<li>
    <a href="../Pi-Debian-Root-on-ZFS/" class="dropdown-item">Raspberry Pi installed with root on ZFS</a>
</li>
                                    
<li>
    <a href="../Pi-Zero_Debian_DS18B20/" class="dropdown-item">Pi Zero/W with working DS18B20</a>
</li>
                                    
<li>
    <a href="../Raspberry-Pi/" class="dropdown-item">Raspberry Pi</a>
</li>
                                    
<li>
    <a href="../TUI-challenge/" class="dropdown-item">Jupiter Broadcasting TUI challenge</a>
</li>
                                    
<li>
    <a href="../Trixie_install_to_NVME/" class="dropdown-item">Trixie install to NVME</a>
</li>
                                    
<li>
    <a href="../Troubleshooting-Debian-root-on-ZFS/" class="dropdown-item">Troubleshooting Debian root on ZFS</a>
</li>
                                    
<li>
    <a href="../ZBM-Void-Linux/" class="dropdown-item">Void Linux, MBR boot using ZFSBootMenu</a>
</li>
                                    
<li>
    <a href="../ZFS-boot-menu/" class="dropdown-item">ZFS boot menu</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">dphacks CM4 Ether Board</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Data</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../data/benchmarks/" class="dropdown-item">CM4 benchmarks</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Test debug</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../test-debug/Pi-4B-Bookworm-WiFi/" class="dropdown-item">Testing networking (WiFi, ETH) Pi 4B</a>
</li>
                                    
<li>
    <a href="../../test-debug/Pi-4B-Bookworm-testing/" class="dropdown-item">Pi 4B Bookworm testing</a>
</li>
                                    
<li>
    <a href="../../test-debug/Pi-4B-KDE_bookworm/" class="dropdown-item">KDE Plasma X11 login hang</a>
</li>
                                    
<li>
    <a href="../../test-debug/Pi-4B-firmware/" class="dropdown-item">Firmware issue raspi-firmware Debian Bookworm</a>
</li>
                                    
<li>
    <a href="../../test-debug/Pi-firmware-2024-04-28/" class="dropdown-item">Pi Firmware 2024-04-28</a>
</li>
                                    
<li>
    <a href="../../test-debug/Pi-new-CM4-WiFi-debugging/" class="dropdown-item">New Raspberry Pi CM4 WiFi testing</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Pi CM4 PCIe</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../test-debug/Pi-CM4-PCIe/Pi_CM4_PCIe_testing/" class="dropdown-item">Pi CM4 PCIe testing</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Sanoid</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../test-debug/Sanoid/sanoid/" class="dropdown-item">Sanoid issue #813 testing</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../ZFS-boot-menu/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../data/benchmarks/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-light">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#dphacks-cm4-ether-board" class="nav-link">dphacks CM4 Ether Board</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#pictures" class="nav-link">Pictures</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2022-10-31-plans" class="nav-link">2022-10-31 Plans</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#baseline-measurements" class="nav-link">Baseline measurements</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#cm4-eb-first-boot" class="nav-link">CM4-EB first boot</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#benchmark-comparison" class="nav-link">Benchmark comparison</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2022-11-01-cm4-power-switch" class="nav-link">2022-11-01 CM4 power switch</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#conclusion" class="nav-link">Conclusion</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="dphacks-cm4-ether-board">dphacks CM4 Ether Board</h1>
<p>Expansion board for the Raspberry Pi Compute Module 4 (CM4) that supports Ethernet, USB and PCIe/NVME SSD.</p>
<p>This board has kindly been provided for testing by <code>@makerbymistake</code> AKA <code>@rpilocator</code> at <a href="https://dphacks.com/">https://dphacks.com/</a> (and IRL André). Thank you!</p>
<p>Board details.</p>
<ul>
<li>USB-C to power the board and CM4</li>
<li>Micro-USB for data with jumper to select host/device mode.  In host mode, the board provides 5V to the USB device plugged in (as determined by the USB standard). Device mode is used to flash the eMMC module. (My CM4 is Lite =&gt; no eMMC so I cannot test this.)</li>
<li>Both the power and data USB ports have basic protection against ESD.</li>
<li>Shorting GND and Global_EN pins (with tweezers, etc) causes the CM4 to boot up when turned off or reboot if already running.</li>
<li>M.2 M Key slot is powered by 3V (standard for SSDs). An M2 screw is provided that fits into the post. Supported SSD size is 2230.</li>
</ul>
<h2 id="pictures">Pictures</h2>
<p>Comparison to NVME adapter.</p>
<p><img alt="alt text" src="../data/PXL_20221031_154632274.jpg" title="comparison to NVME adapter" /></p>
<p>Ether Board with CM4 + heatsink installed.</p>
<p><img alt="alt text" src="../data/PXL_20221031_154659317.jpg" title="Ether Board with CM4 and heatsink installed" /></p>
<h2 id="2022-10-31-plans">2022-10-31 Plans</h2>
<p>Happy Halloween!</p>
<p>I have a CM4 Lite with WiFi and 8GB RAM. I have been testing this with the official R-Pi expansion board (Pi-EB) including booting from NVME. For my Raspberry Pi 4B devices I prefer to use pure Debian but it will not boot the CM4 if anything is connected to the PCIe slot so it is a non-starter. I have an ARM64 R-Pi OS image installed on a 256GB Kioxia (PCIe X1) NVME SSD that I plan to test with.</p>
<p>The networking and NVME performance are the things I am most curious about. I may explore other areas such as USB boot and perhaps the connections for shutting down and booting the CM4.</p>
<h2 id="baseline-measurements">Baseline measurements</h2>
<p>I plan to use <code>iperf3</code> and some common disk benchmarks to evaluate performance. Before swapping the CM4/heat sink and SSD to the CM4 Ether Board (CM4-EB) I'll complete the benchmarks on the Pi-EB. At this point I generally collect the time to complete the disk benchmarks as a first approximation of performance and will look at the detailed results if anything interesting comes up.</p>
<p>Before proceeding I upgraded all available packages and this provides the kernel</p>
<pre><code class="language-text">hbarta@cm4nvme:~ $ uname -a
Linux cm4nvme 5.15.74-v8+ #1595 SMP PREEMPT Wed Oct 26 11:07:24 BST 2022 aarch64 GNU/Linux
hbarta@cm4nvme:~ $ 
</code></pre>
<p>I have Gnome installed and will disable that for this testing since the CM4-EB has no video output.</p>
<p>Before swapping boards the host name was changed to avoid SSH login issues (and my confusion.)</p>
<pre><code class="language-text">sudo hostnamectl set-hostname cm4eb
</code></pre>
<h2 id="cm4-eb-first-boot">CM4-EB first boot</h2>
<p>Uneventful. It came up, connected to my LAN via Ethernet and I was able to SSH in. Results of <code>ip addr</code> indicates that WiFi is working as well (though that resides entirely on the CM4.) At present the D2 (green) LED is flickering at about 1/s and the D3 (red) LED is on continuous. On to the benchmarks!</p>
<p>Quick reactions - The Ethernet and NVME performance seem pretty close to that on the official IO Board and this is both desired and expected.</p>
<h2 id="benchmark-comparison">Benchmark comparison</h2>
<h3 id="network">Network</h3>
<table>
<thead>
<tr>
<th>board</th>
<th>ping</th>
<th>iperf3</th>
<th></th>
<th>notes</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>min/avg/max/mdev</td>
<td>Mbits/sec snd</td>
<td>recv</td>
<td></td>
</tr>
<tr>
<td>IO</td>
<td>0.146/0.191/0.227/0.024</td>
<td></td>
<td></td>
<td>olive</td>
</tr>
<tr>
<td></td>
<td>0.214/0.270/0.551/0.094</td>
<td>924</td>
<td>919</td>
<td>oak</td>
</tr>
<tr>
<td>EB</td>
<td>0.164/0.204/0.278/0.038</td>
<td></td>
<td></td>
<td>olive</td>
</tr>
<tr>
<td></td>
<td>0.213/0.265/0.489/0.075</td>
<td>904</td>
<td>899</td>
<td>oak</td>
</tr>
</tbody>
</table>
<h3 id="disk">Disk</h3>
<p>Crude results - just time to complete the benchmark. Details can be <a href="../data/benchmarks/">viewed here</a></p>
<table>
<thead>
<tr>
<th>board</th>
<th>fio</th>
<th></th>
<th>dd</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>time</td>
<td>rerun</td>
<td>time</td>
</tr>
<tr>
<td>IO</td>
<td>101</td>
<td>121</td>
<td>130</td>
</tr>
<tr>
<td>EB</td>
<td>101</td>
<td>124</td>
<td>128</td>
</tr>
</tbody>
</table>
<h2 id="2022-11-01-cm4-power-switch">2022-11-01 CM4 power switch</h2>
<p>I implemented the software/config to implement a power switch. Jumper wires used temporarily in place of switch. Instructions at <a href="https://www.alexwhittemore.com/raspberry-pi-cm4-using-nrpi_boot/">https://www.alexwhittemore.com/raspberry-pi-cm4-using-nrpi_boot/</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>One of the most important attributes of the CM4 is that it exposes a PCIe lane on the connectors. The official IO Board routes this to a PCIe x1 slot and the <code>@makerbymistake</code> board brings this out directly to an NVME slot. This is an ideal board to use for a headless file server where Ethernet and NVME provide all of the I/O is needed. Other functions that depend only on Ethernet such as Pi-Hole could also be supported at full Gigabit Ethernet speed and all with a footprint a fraction of the space required for the official board. I also like that it is powered from a USB-C connector vs. the barrel used on the official board. I did not test the (micro) USB data connector but I understand that <code>@makerbymistake</code> has used it to run OctoPrint.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
